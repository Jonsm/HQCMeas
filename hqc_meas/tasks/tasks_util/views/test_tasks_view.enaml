from enaml.layout.api import hbox, spacer, align
from enaml.widgets.api import (Container, GroupBox, Label, Form, Field)
from enaml.stdlib.fields import FloatField

from hqc_meas.utils.widgets.qt_line_completer import QtLineCompleter
from hqc_meas.tasks.tools.pair_editor import PairEditor

enamldef PrintView(GroupBox):

    attr task
    attr in_loop : bool = False
    title << task.task_name
    padding = (0,0,5,5)

    Form:
        Label:
            text = 'Message'
        QtLineCompleter:
            text := task.message
            entries_updater << task._list_database_entries


enamldef SleepView(GroupBox):

    attr task
    title << task.task_name
    padding = (0,0,5,5)

    Container:
        constraints = [hbox(lab, time, unit),
                        align('v_center', lab, time),
                        align('v_center', time, unit)]
        Label: lab:
            text = 'Time to sleep'
        FloatField: time:
            value := task.time
        Label: unit:
            text = 's'


enamldef Def(Container):

    attr model
    constraints = [hbox(lab, defi)]
    padding = (0,2,0,0)

    Field: lab:
        hug_width = 'strong'
        text := model.label
    Field: defi:
        hug_width = 'ignore'
        text := model.value

enamldef DefinitionView(GroupBox):

    attr task
    title << task.task_name
    padding = (0,0,5,5)

    PairEditor(Def): defs:
        defs.title = 'Label : Value'
        defs.model := task
        defs.iterable_name = 'definitions'

TASK_VIEW_MAPPING = {'PrintTask' : PrintView,
                     'SleepTask' : SleepView,
                     'DefinitionTask' : DefinitionView}
